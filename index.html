<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>LEGION LIVE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<!-- =================== ROMAN LEGION THEME =================== -->
<style>
* { box-sizing: border-box; }

:root {
  --bg: #070707;
  --panel: #111111;
  --border: #3a2a14;
  --primary: #7b0d0d;
  --accent: #b08d57;
  --text: #e8e3d9;
  --muted: #8a8a8a;
}

body {
  margin: 0;
  background: radial-gradient(circle at top, #0f0f0f, var(--bg));
  color: var(--text);
  font-family: system-ui, sans-serif;
}

/* =================== HEADER =================== */
header {
  padding: 20px;
  text-align: center;
  font-size: 1.8rem;
  font-weight: 900;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: var(--accent);
  background: linear-gradient(to bottom, #140b0b, #050505);
  border-bottom: 3px solid var(--border);
}

/* Subtle Legion Insignia */
header::after {
  content: "⚔";
  display: block;
  font-size: 1.2rem;
  margin-top: 6px;
  opacity: 0.6;
}

/* =================== NAV =================== */
nav {
  display: flex;
  justify-content: center;
  gap: 12px;
  padding: 12px;
  background: #0b0b0b;
  border-bottom: 1px solid var(--border);
}

nav button {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--border);
  padding: 8px 16px;
  border-radius: 6px;
  font-weight: 700;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

nav button:hover {
  background: var(--primary);
  border-color: var(--accent);
}

/* =================== LAYOUT =================== */
main {
  max-width: 1100px;
  margin: auto;
  padding: 18px;
}

.card {
  background: linear-gradient(145deg, #121212, #0b0b0b);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: inset 0 0 0 1px rgba(176,141,87,0.05);
}

/* Roman Standard Divider */
.divider {
  display: flex;
  align-items: center;
  margin: 18px 0;
  opacity: 0.8;
}

.divider::before,
.divider::after {
  content: "";
  flex: 1;
  height: 1px;
  background: var(--border);
}

.divider span {
  margin: 0 12px;
  color: var(--accent);
  font-weight: 700;
  letter-spacing: 0.15em;
}

/* =================== TEXT =================== */
h2 {
  margin-top: 0;
  color: var(--accent);
  letter-spacing: 0.12em;
  text-transform: uppercase;
}

.small {
  color: var(--muted);
  font-size: 0.85rem;
}

/* =================== INPUTS =================== */
input, textarea {
  width: 100%;
  background: #050505;
  border: 1px solid var(--border);
  color: var(--text);
  padding: 10px;
  border-radius: 6px;
  margin-bottom: 12px;
}

/* =================== BUTTONS =================== */
button.primary {
  background: linear-gradient(to bottom, #8f1414, var(--primary));
  border: 1px solid var(--accent);
  padding: 12px;
  color: #fff;
  border-radius: 6px;
  font-weight: 800;
  letter-spacing: 0.1em;
  text-transform: uppercase;
}

button.primary:hover {
  filter: brightness(1.1);
}

/* =================== VIDEO =================== */
video {
  width: 100%;
  border-radius: 10px;
  border: 2px solid var(--border);
  background: #000;
}

/* =================== WARNINGS =================== */
.warning {
  background: linear-gradient(to bottom, #2a0a0a, #1a0505);
  border: 1px solid var(--primary);
  padding: 14px;
  border-radius: 10px;
  color: #ffb3b3;
  font-weight: 700;
}

/* =================== RANK BADGES =================== */
.rank {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  font-size: 0.75rem;
  font-weight: 800;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  border: 1px solid var(--border);
}

.rank.viewer { background: #222; }
.rank.legionnaire { background: #4a0f0f; color: #fff; }
.rank.centurion { background: #7b0d0d; border-color: var(--accent); }
.rank.tribune { background: #b08d57; color: #000; }

/* =================== TRIBUNAL PANEL =================== */
.tribunal {
  background: linear-gradient(145deg, #1a1212, #0c0808);
  border: 2px solid var(--accent);
}

.tribunal h2 {
  color: #ffcccc;
}
</style>
</head>

<body>

<header>LEGION • LIVE</header>

<nav>
  <button onclick="route('home')">Home</button>
  <button onclick="route('login')">Login</button>
  <button onclick="route('profile')">Profile</button>
  <button onclick="route('stream')">Go Live</button>
  <button onclick="route('admin')">Tribunal</button>
</nav>

<main id="app"></main>

<script>
// ================= CONFIG =================
const API_BASE = "https://legion-live-backend.onrender.com";

// ================= STATE ==================
const app = document.getElementById("app");
const state = {
  user: JSON.parse(localStorage.getItem("legion_user")) || null,
  ageVerified: localStorage.getItem("age_verified") === "yes"
};

function saveUser() {
  localStorage.setItem("legion_user", JSON.stringify(state.user));
}

// ================= ROUTER =================
function route(page) {
  if (page === "home") renderHome();
  if (page === "login") renderLogin();
  if (page === "profile") renderProfile();
  if (page === "stream") renderStream();
  if (page === "admin") renderAdmin();
}

// ================= SCREENS =================
function renderHome() {
  app.innerHTML = `
    <div class="card">
      <h2>Legion Protocol</h2>
      <div class="divider"><span>⚔</span></div>
      ${!state.ageVerified ? `
        <div class="warning">
          Tribunal Decree: 21+ Only
          <br><br>
          <button class="primary" onclick="verifyAge()">I Am 21+</button>
        </div>` :
        `<p class="small">Age verified by decree ✔</p>`}
    </div>`;
}

function verifyAge() {
  state.ageVerified = true;
  localStorage.setItem("age_verified", "yes");
  renderHome();
}

function renderLogin() {
  app.innerHTML = `
    <div class="card">
      <h2>Enter the Legion</h2>
      <div class="divider"><span>STANDARD</span></div>
      <input placeholder="Email" id="email" />
      <button class="primary" onclick="login()">Proceed</button>
    </div>`;
}

async function login() {
  if (!state.ageVerified) {
    alert("Tribunal requires 21+ verification.");
    return;
  }

  const email = document.getElementById("email").value;

  const res = await fetch(API_BASE + "/auth/login", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-region": "NA"
    },
    body: JSON.stringify({ email, ageVerified: true })
  });

  const data = await res.json();

  if (data.token) {
    state.user = {
      email,
      token: data.token,
      name: email.split("@")[0],
      rank: "legionnaire"
    };
    saveUser();
    route("profile");
  } else {
    alert(data.error || "Denied by tribunal.");
  }
}

function renderProfile() {
  if (!state.user) return route("login");

  app.innerHTML = `
    <div class="card">
      <h2>Legionnaire Record</h2>
      <span class="rank ${state.user.rank}">${state.user.rank}</span>
      <div class="divider"><span>INSIGNIA</span></div>
      <input value="${state.user.name}" onchange="updateName(this.value)" />
      <textarea placeholder="Oath / About Me"></textarea>
    </div>`;
}

function updateName(v) {
  state.user.name = v;
  saveUser();
}

let mediaStream = null;

function renderStream() {
  app.innerHTML = `
    <div class="card">
      <h2>Broadcast Standard</h2>
      <video id="video" autoplay muted></video>
      <div class="divider"><span>LIVE</span></div>
      <button class="primary" onclick="startStream()">Raise Standard</button>
      <button onclick="stopStream()">Lower Standard</button>
    </div>`;
}

async function startStream() {
  try {
    mediaStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
    document.getElementById("video").srcObject = mediaStream;
  } catch {
    alert("Tribunal denied camera or microphone.");
  }
}

function stopStream() {
  if (mediaStream) {
    mediaStream.getTracks().forEach(t => t.stop());
  }
}

/* ================= TRIBUNAL (ADMIN UI) ================= */
function renderAdmin() {
  app.innerHTML = `
    <div class="card tribunal">
      <h2>Tribunal Chamber</h2>
      <div class="divider"><span>JUDGMENT</span></div>
      <p class="small">
        Administrative oversight, stream termination, and enforcement actions.
        (UI only — logic enforced server-side.)
      </p>
      <button class="primary">Terminate Stream</button>
    </div>`;
}

route("home");
</script>

</body>
</html>
